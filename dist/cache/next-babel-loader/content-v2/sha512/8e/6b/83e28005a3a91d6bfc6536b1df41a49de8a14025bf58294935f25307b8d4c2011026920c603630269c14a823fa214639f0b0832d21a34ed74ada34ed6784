{"ast":null,"code":"var _classCallCheck = require(\"C:/Users/didi/Desktop/frontend.ro/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/didi/Desktop/frontend.ro/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _assertThisInitialized = require(\"C:/Users/didi/Desktop/frontend.ro/node_modules/@babel/runtime/helpers/assertThisInitialized\");\n\nvar _inherits = require(\"C:/Users/didi/Desktop/frontend.ro/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _possibleConstructorReturn = require(\"C:/Users/didi/Desktop/frontend.ro/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"C:/Users/didi/Desktop/frontend.ro/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _wrapNativeSuper = require(\"C:/Users/didi/Desktop/frontend.ro/node_modules/@babel/runtime/helpers/wrapNativeSuper\");\n\nvar _defineProperty = require(\"C:/Users/didi/Desktop/frontend.ro/node_modules/@babel/runtime/helpers/defineProperty\");\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nvar mongoose = require('mongoose');\n\nvar _require = require('./database'),\n    extractDbErrorMessage = _require.extractDbErrorMessage;\n\nvar PAGE_SIZE = 25;\nvar AUTH_EXPIRATION = 7;\nvar MAX_NAME_LENGTH = 255;\nvar MAX_USERNAME_LENGTH = 100;\n\nvar ServerError = /*#__PURE__*/function (_Error) {\n  \"use strict\";\n\n  _inherits(ServerError, _Error);\n\n  var _super = _createSuper(ServerError);\n\n  function ServerError(code, err) {\n    var _this;\n\n    _classCallCheck(this, ServerError);\n\n    for (var _len = arguments.length, rest = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      rest[_key - 2] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(rest));\n\n    _defineProperty(_assertThisInitialized(_this), \"code\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"message\", void 0);\n\n    _this.code = code;\n\n    if (typeof err === 'object') {\n      _this.message = extractDbErrorMessage(err);\n    } else {\n      _this.message = err;\n    }\n\n    return _this;\n  }\n\n  _createClass(ServerError, [{\n    key: \"send\",\n    value: function send(res) {\n      res.status(this.code);\n      res.json({\n        code: this.code,\n        message: this.message\n      });\n    }\n  }]);\n\n  return ServerError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n\nfunction setTokenCookie(token, res) {\n  res.cookie('token', token);\n}\n/** Verify that payload doesn't have extra props not present on the Schema */\n\n\nfunction validateAgainstSchemaProps(payload, Schema) {\n  var keys = Object.keys(payload); // eslint-disable-next-line no-restricted-syntax\n\n  for (var _i = 0, _keys = keys; _i < _keys.length; _i++) {\n    var key = _keys[_i];\n\n    if (!(key in Schema.obj)) {\n      throw new ServerError(400, \"Property '\".concat(key, \"' cannot be directly set.\"));\n    }\n  }\n}\n\nfunction validateObjectId(_id) {\n  if (!mongoose.isValidObjectId(_id)) {\n    throw new ServerError(400, \"Value '\".concat(_id, \"' is not a valid ObjectId identifier\"));\n  }\n}\n\nmodule.exports = {\n  ServerError: ServerError,\n  PAGE_SIZE: PAGE_SIZE,\n  AUTH_EXPIRATION: AUTH_EXPIRATION,\n  MAX_NAME_LENGTH: MAX_NAME_LENGTH,\n  MAX_USERNAME_LENGTH: MAX_USERNAME_LENGTH,\n  setTokenCookie: setTokenCookie,\n  validateAgainstSchemaProps: validateAgainstSchemaProps,\n  validateObjectId: validateObjectId\n};","map":{"version":3,"sources":["C:/Users/didi/Desktop/frontend.ro/server/ServerUtils.js"],"names":["mongoose","require","extractDbErrorMessage","PAGE_SIZE","AUTH_EXPIRATION","MAX_NAME_LENGTH","MAX_USERNAME_LENGTH","ServerError","code","err","rest","message","res","status","json","Error","setTokenCookie","token","cookie","validateAgainstSchemaProps","payload","Schema","keys","Object","key","obj","validateObjectId","_id","isValidObjectId","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;eACkCA,OAAO,CAAC,YAAD,C;IAAjCC,qB,YAAAA,qB;;AAER,IAAMC,SAAS,GAAG,EAAlB;AAEA,IAAMC,eAAe,GAAG,CAAxB;AACA,IAAMC,eAAe,GAAG,GAAxB;AACA,IAAMC,mBAAmB,GAAG,GAA5B;;IAEMC,W;;;;;;;AAKJ,uBAAYC,IAAZ,EAAkBC,GAAlB,EAAgC;AAAA;;AAAA;;AAAA,sCAANC,IAAM;AAANA,MAAAA,IAAM;AAAA;;AAC9B,oDAASA,IAAT;;AAD8B;;AAAA;;AAG9B,UAAKF,IAAL,GAAYA,IAAZ;;AAEA,QAAI,OAAOC,GAAP,KAAe,QAAnB,EAA6B;AAC3B,YAAKE,OAAL,GAAeT,qBAAqB,CAACO,GAAD,CAApC;AACD,KAFD,MAEO;AACL,YAAKE,OAAL,GAAeF,GAAf;AACD;;AAT6B;AAU/B;;;;yBAEIG,G,EAAK;AACRA,MAAAA,GAAG,CAACC,MAAJ,CAAW,KAAKL,IAAhB;AACAI,MAAAA,GAAG,CAACE,IAAJ,CAAS;AACPN,QAAAA,IAAI,EAAE,KAAKA,IADJ;AAEPG,QAAAA,OAAO,EAAE,KAAKA;AAFP,OAAT;AAID;;;;iCAvBuBI,K;;AA0B1B,SAASC,cAAT,CAAwBC,KAAxB,EAA+BL,GAA/B,EAAoC;AAClCA,EAAAA,GAAG,CAACM,MAAJ,CAAW,OAAX,EAAoBD,KAApB;AACD;AAED;;;AACA,SAASE,0BAAT,CAAoCC,OAApC,EAA6CC,MAA7C,EAAqD;AACnD,MAAMC,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYF,OAAZ,CAAb,CADmD,CAGnD;;AACA,2BAAkBE,IAAlB,2BAAwB;AAAnB,QAAME,GAAG,YAAT;;AACH,QAAI,EAAEA,GAAG,IAAIH,MAAM,CAACI,GAAhB,CAAJ,EAA0B;AACxB,YAAM,IAAIlB,WAAJ,CAAgB,GAAhB,sBAAkCiB,GAAlC,+BAAN;AACD;AACF;AACF;;AAED,SAASE,gBAAT,CAA0BC,GAA1B,EAA+B;AAC7B,MAAI,CAAC3B,QAAQ,CAAC4B,eAAT,CAAyBD,GAAzB,CAAL,EAAoC;AAClC,UAAM,IAAIpB,WAAJ,CAAgB,GAAhB,mBAA+BoB,GAA/B,0CAAN;AACD;AACF;;AAEDE,MAAM,CAACC,OAAP,GAAiB;AACfvB,EAAAA,WAAW,EAAXA,WADe;AAEfJ,EAAAA,SAAS,EAATA,SAFe;AAGfC,EAAAA,eAAe,EAAfA,eAHe;AAIfC,EAAAA,eAAe,EAAfA,eAJe;AAKfC,EAAAA,mBAAmB,EAAnBA,mBALe;AAMfU,EAAAA,cAAc,EAAdA,cANe;AAOfG,EAAAA,0BAA0B,EAA1BA,0BAPe;AAQfO,EAAAA,gBAAgB,EAAhBA;AARe,CAAjB","sourcesContent":["const mongoose = require('mongoose');\r\nconst { extractDbErrorMessage } = require('./database');\r\n\r\nconst PAGE_SIZE = 25;\r\n\r\nconst AUTH_EXPIRATION = 7;\r\nconst MAX_NAME_LENGTH = 255;\r\nconst MAX_USERNAME_LENGTH = 100;\r\n\r\nclass ServerError extends Error {\r\n  code;\r\n\r\n  message;\r\n\r\n  constructor(code, err, ...rest) {\r\n    super(...rest);\r\n\r\n    this.code = code;\r\n\r\n    if (typeof err === 'object') {\r\n      this.message = extractDbErrorMessage(err);\r\n    } else {\r\n      this.message = err;\r\n    }\r\n  }\r\n\r\n  send(res) {\r\n    res.status(this.code);\r\n    res.json({\r\n      code: this.code,\r\n      message: this.message,\r\n    });\r\n  }\r\n}\r\n\r\nfunction setTokenCookie(token, res) {\r\n  res.cookie('token', token);\r\n}\r\n\r\n/** Verify that payload doesn't have extra props not present on the Schema */\r\nfunction validateAgainstSchemaProps(payload, Schema) {\r\n  const keys = Object.keys(payload);\r\n\r\n  // eslint-disable-next-line no-restricted-syntax\r\n  for (const key of keys) {\r\n    if (!(key in Schema.obj)) {\r\n      throw new ServerError(400, `Property '${key}' cannot be directly set.`);\r\n    }\r\n  }\r\n}\r\n\r\nfunction validateObjectId(_id) {\r\n  if (!mongoose.isValidObjectId(_id)) {\r\n    throw new ServerError(400, `Value '${_id}' is not a valid ObjectId identifier`);\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  ServerError,\r\n  PAGE_SIZE,\r\n  AUTH_EXPIRATION,\r\n  MAX_NAME_LENGTH,\r\n  MAX_USERNAME_LENGTH,\r\n  setTokenCookie,\r\n  validateAgainstSchemaProps,\r\n  validateObjectId,\r\n}"]},"metadata":{},"sourceType":"script"}