{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport cookie from 'cookie';\nimport { extractDbErrorMessage } from './database';\nexport const PAGE_SIZE = 25;\nexport const AUTH_EXPIRATION = 7;\nexport class ServerError extends Error {\n  constructor(code, err, ...rest) {\n    super(...rest);\n\n    _defineProperty(this, \"code\", void 0);\n\n    _defineProperty(this, \"message\", void 0);\n\n    this.code = code;\n\n    if (typeof err === 'object') {\n      this.message = extractDbErrorMessage(err);\n    } else {\n      this.message = err;\n    }\n  }\n\n  send(res) {\n    res.status(this.code);\n    res.json({\n      code: this.code,\n      message: this.message\n    });\n  }\n\n}\nexport function setTokenCookie(token, res) {\n  res.setHeader('Set-Cookie', cookie.serialize('token', token, {\n    httpOnly: true,\n    secure: false,\n    sameSite: 'strict',\n    maxAge: 3600 * 24 * AUTH_EXPIRATION,\n    path: '/'\n  }));\n}","map":{"version":3,"sources":["/Users/nmaties/Projects/personal/frontend.ro/frontend-ssr/server/ServerUtils.ts"],"names":["cookie","extractDbErrorMessage","PAGE_SIZE","AUTH_EXPIRATION","ServerError","Error","constructor","code","err","rest","message","send","res","status","json","setTokenCookie","token","setHeader","serialize","httpOnly","secure","sameSite","maxAge","path"],"mappings":";;AACA,OAAOA,MAAP,MAAmB,QAAnB;AACA,SAASC,qBAAT,QAAsC,YAAtC;AAEA,OAAO,MAAMC,SAAS,GAAG,EAAlB;AACP,OAAO,MAAMC,eAAe,GAAG,CAAxB;AACP,OAAO,MAAMC,WAAN,SAA0BC,KAA1B,CAAgC;AAKrCC,EAAAA,WAAW,CAACC,IAAD,EAAOC,GAAP,EAAY,GAAGC,IAAf,EAAqB;AAC9B,UAAM,GAAGA,IAAT;;AAD8B;;AAAA;;AAG9B,SAAKF,IAAL,GAAYA,IAAZ;;AAEA,QAAI,OAAOC,GAAP,KAAe,QAAnB,EAA6B;AAC3B,WAAKE,OAAL,GAAeT,qBAAqB,CAACO,GAAD,CAApC;AACD,KAFD,MAEO;AACL,WAAKE,OAAL,GAAeF,GAAf;AACD;AACF;;AAEDG,EAAAA,IAAI,CAACC,GAAD,EAAuB;AACzBA,IAAAA,GAAG,CAACC,MAAJ,CAAW,KAAKN,IAAhB;AACAK,IAAAA,GAAG,CAACE,IAAJ,CAAS;AACPP,MAAAA,IAAI,EAAE,KAAKA,IADJ;AAEPG,MAAAA,OAAO,EAAE,KAAKA;AAFP,KAAT;AAID;;AAvBoC;AA0BvC,OAAO,SAASK,cAAT,CAAwBC,KAAxB,EAAuCJ,GAAvC,EAAkE;AACvEA,EAAAA,GAAG,CAACK,SAAJ,CACE,YADF,EAEEjB,MAAM,CAACkB,SAAP,CAAiB,OAAjB,EAA0BF,KAA1B,EAAiC;AAC/BG,IAAAA,QAAQ,EAAE,IADqB;AAE/BC,IAAAA,MAAM,OAFyB;AAG/BC,IAAAA,QAAQ,EAAE,QAHqB;AAI/BC,IAAAA,MAAM,EAAE,OAAO,EAAP,GAAYnB,eAJW;AAK/BoB,IAAAA,IAAI,EAAE;AALyB,GAAjC,CAFF;AAUD","sourcesContent":["import { NextApiResponse } from 'next';\nimport cookie from 'cookie';\nimport { extractDbErrorMessage } from './database';\n\nexport const PAGE_SIZE = 25;\nexport const AUTH_EXPIRATION = 7;\nexport class ServerError extends Error {\n  code: number;\n\n  message: string;\n\n  constructor(code, err, ...rest) {\n    super(...rest);\n\n    this.code = code;\n\n    if (typeof err === 'object') {\n      this.message = extractDbErrorMessage(err);\n    } else {\n      this.message = err;\n    }\n  }\n\n  send(res: NextApiResponse) {\n    res.status(this.code);\n    res.json({\n      code: this.code,\n      message: this.message,\n    });\n  }\n}\n\nexport function setTokenCookie(token: string, res: NextApiResponse<any>) {\n  res.setHeader(\n    'Set-Cookie',\n    cookie.serialize('token', token, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV !== 'development',\n      sameSite: 'strict',\n      maxAge: 3600 * 24 * AUTH_EXPIRATION,\n      path: '/',\n    }),\n  );\n}\n"]},"metadata":{},"sourceType":"module"}