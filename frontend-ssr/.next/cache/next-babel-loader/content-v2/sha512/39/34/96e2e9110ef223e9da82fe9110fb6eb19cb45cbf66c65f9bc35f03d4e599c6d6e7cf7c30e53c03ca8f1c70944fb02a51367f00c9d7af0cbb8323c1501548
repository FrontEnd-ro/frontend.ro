{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _wrapNativeSuper from \"@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport cookie from 'cookie';\nimport { extractDbErrorMessage } from './database';\nexport var PAGE_SIZE = 25;\nexport var AUTH_EXPIRATION = 7;\nexport var ServerError = /*#__PURE__*/function (_Error) {\n  _inherits(ServerError, _Error);\n\n  var _super = _createSuper(ServerError);\n\n  function ServerError(code, err) {\n    var _this;\n\n    _classCallCheck(this, ServerError);\n\n    for (var _len = arguments.length, rest = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      rest[_key - 2] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(rest));\n\n    _defineProperty(_assertThisInitialized(_this), \"code\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"message\", void 0);\n\n    _this.code = code;\n\n    if (typeof err === 'object') {\n      _this.message = extractDbErrorMessage(err);\n    } else {\n      _this.message = err;\n    }\n\n    return _this;\n  }\n\n  _createClass(ServerError, [{\n    key: \"send\",\n    value: function send(res) {\n      res.status(this.code);\n      res.json({\n        code: this.code,\n        message: this.message\n      });\n    }\n  }]);\n\n  return ServerError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nexport function setTokenCookie(token, res) {\n  res.setHeader('Set-Cookie', cookie.serialize('token', token, {\n    httpOnly: true,\n    secure: false,\n    sameSite: 'strict',\n    maxAge: 3600 * 24 * AUTH_EXPIRATION,\n    path: '/'\n  }));\n}","map":{"version":3,"sources":["/Users/nmaties/Projects/personal/frontend.ro/frontend-ssr/server/ServerUtils.ts"],"names":["cookie","extractDbErrorMessage","PAGE_SIZE","AUTH_EXPIRATION","ServerError","code","err","rest","message","res","status","json","Error","setTokenCookie","token","setHeader","serialize","httpOnly","secure","sameSite","maxAge","path"],"mappings":";;;;;;;;;;;;;AACA,OAAOA,MAAP,MAAmB,QAAnB;AACA,SAASC,qBAAT,QAAsC,YAAtC;AAEA,OAAO,IAAMC,SAAS,GAAG,EAAlB;AACP,OAAO,IAAMC,eAAe,GAAG,CAAxB;AACP,WAAaC,WAAb;AAAA;;AAAA;;AAKE,uBAAYC,IAAZ,EAAkBC,GAAlB,EAAgC;AAAA;;AAAA;;AAAA,sCAANC,IAAM;AAANA,MAAAA,IAAM;AAAA;;AAC9B,oDAASA,IAAT;;AAD8B;;AAAA;;AAG9B,UAAKF,IAAL,GAAYA,IAAZ;;AAEA,QAAI,OAAOC,GAAP,KAAe,QAAnB,EAA6B;AAC3B,YAAKE,OAAL,GAAeP,qBAAqB,CAACK,GAAD,CAApC;AACD,KAFD,MAEO;AACL,YAAKE,OAAL,GAAeF,GAAf;AACD;;AAT6B;AAU/B;;AAfH;AAAA;AAAA,yBAiBOG,GAjBP,EAiB6B;AACzBA,MAAAA,GAAG,CAACC,MAAJ,CAAW,KAAKL,IAAhB;AACAI,MAAAA,GAAG,CAACE,IAAJ,CAAS;AACPN,QAAAA,IAAI,EAAE,KAAKA,IADJ;AAEPG,QAAAA,OAAO,EAAE,KAAKA;AAFP,OAAT;AAID;AAvBH;;AAAA;AAAA,iCAAiCI,KAAjC;AA0BA,OAAO,SAASC,cAAT,CAAwBC,KAAxB,EAAuCL,GAAvC,EAAkE;AACvEA,EAAAA,GAAG,CAACM,SAAJ,CACE,YADF,EAEEf,MAAM,CAACgB,SAAP,CAAiB,OAAjB,EAA0BF,KAA1B,EAAiC;AAC/BG,IAAAA,QAAQ,EAAE,IADqB;AAE/BC,IAAAA,MAAM,OAFyB;AAG/BC,IAAAA,QAAQ,EAAE,QAHqB;AAI/BC,IAAAA,MAAM,EAAE,OAAO,EAAP,GAAYjB,eAJW;AAK/BkB,IAAAA,IAAI,EAAE;AALyB,GAAjC,CAFF;AAUD","sourcesContent":["import { NextApiResponse } from 'next';\nimport cookie from 'cookie';\nimport { extractDbErrorMessage } from './database';\n\nexport const PAGE_SIZE = 25;\nexport const AUTH_EXPIRATION = 7;\nexport class ServerError extends Error {\n  code: number;\n\n  message: string;\n\n  constructor(code, err, ...rest) {\n    super(...rest);\n\n    this.code = code;\n\n    if (typeof err === 'object') {\n      this.message = extractDbErrorMessage(err);\n    } else {\n      this.message = err;\n    }\n  }\n\n  send(res: NextApiResponse) {\n    res.status(this.code);\n    res.json({\n      code: this.code,\n      message: this.message,\n    });\n  }\n}\n\nexport function setTokenCookie(token: string, res: NextApiResponse<any>) {\n  res.setHeader(\n    'Set-Cookie',\n    cookie.serialize('token', token, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV !== 'development',\n      sameSite: 'strict',\n      maxAge: 3600 * 24 * AUTH_EXPIRATION,\n      path: '/',\n    }),\n  );\n}\n"]},"metadata":{},"sourceType":"module"}