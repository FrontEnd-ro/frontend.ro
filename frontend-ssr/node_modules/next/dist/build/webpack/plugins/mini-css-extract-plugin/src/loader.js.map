{"version":3,"sources":["../../../../../../build/webpack/plugins/mini-css-extract-plugin/src/loader.js"],"names":["isWebpack5","parseInt","webpack","version","pluginName","evalModuleCode","loaderContext","code","filename","module","NativeModule","paths","_nodeModulePaths","context","_compile","exports","getModuleId","compilation","chunkGraph","id","findModuleById","modules","pitch","request","options","loaderUtils","getOptions","loaders","slice","loaderIndex","addDependency","resourcePath","childFilename","publicPath","endsWith","rootContext","_compilation","outputOptions","library","type","name","childCompiler","createChildCompiler","node","NodeTemplatePlugin","apply","EnableLibraryPlugin","LibraryTemplatePlugin","NodeTargetPlugin","EntryPlugin","SingleEntryPlugin","optimize","LimitChunkCountPlugin","maxChunks","source","hooks","thisCompilation","tap","hook","NormalModule","getCompilationHooks","loader","normalModuleLoader","emitFile","map","path","ident","processAssets","stage","Compilation","PROCESS_ASSETS_STAGE_ADDITIONAL","assets","Object","keys","forEach","file","afterCompile","chunks","chunk","files","callback","async","runAsChild","err","entries","addDependencies","dependencies","Array","isArray","Error","JSON","stringify","identifierCountMap","Map","dependency","count","get","identifier","_module","CssDependency","set","errors","length","fileDependencies","dep","contextDependencies","addContextDependency","locals","__esModule","default","content","media","sourceMap","e","esModule","result","resultSource"],"mappings":"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","sourcesContent":["import NativeModule from 'module'\n\nimport loaderUtils from 'loader-utils'\nimport webpack from 'webpack'\nimport NodeTargetPlugin from 'webpack/lib/node/NodeTargetPlugin'\n\nimport CssDependency from './CssDependency'\n\nconst isWebpack5 = parseInt(webpack.version) === 5\nconst pluginName = 'mini-css-extract-plugin'\n\nfunction evalModuleCode(loaderContext, code, filename) {\n  const module = new NativeModule(filename, loaderContext)\n\n  module.paths = NativeModule._nodeModulePaths(loaderContext.context) // eslint-disable-line no-underscore-dangle\n  module.filename = filename\n  module._compile(code, filename) // eslint-disable-line no-underscore-dangle\n\n  return module.exports\n}\n\nfunction getModuleId(compilation, module) {\n  if (isWebpack5) {\n    return compilation.chunkGraph.getModuleId(module)\n  }\n\n  return module.id\n}\n\nfunction findModuleById(compilation, id) {\n  for (const module of compilation.modules) {\n    if (getModuleId(compilation, module) === id) {\n      return module\n    }\n  }\n\n  return null\n}\n\nexport function pitch(request) {\n  const options = loaderUtils.getOptions(this) || {}\n\n  const loaders = this.loaders.slice(this.loaderIndex + 1)\n\n  this.addDependency(this.resourcePath)\n\n  const childFilename = '*'\n  const publicPath =\n    typeof options.publicPath === 'string'\n      ? options.publicPath === '' || options.publicPath.endsWith('/')\n        ? options.publicPath\n        : `${options.publicPath}/`\n      : typeof options.publicPath === 'function'\n      ? options.publicPath(this.resourcePath, this.rootContext)\n      : this._compilation.outputOptions.publicPath\n  const outputOptions = {\n    filename: childFilename,\n    publicPath,\n    library: {\n      type: 'commonjs2',\n      name: null,\n    },\n  }\n  const childCompiler = this._compilation.createChildCompiler(\n    `${pluginName} ${request}`,\n    outputOptions\n  )\n\n  new webpack.node.NodeTemplatePlugin(outputOptions).apply(childCompiler)\n  if (isWebpack5) {\n    new webpack.library.EnableLibraryPlugin(outputOptions.library.type).apply(\n      childCompiler\n    )\n  } else {\n    new webpack.LibraryTemplatePlugin(null, 'commonjs2').apply(childCompiler)\n  }\n  new NodeTargetPlugin().apply(childCompiler)\n  new (isWebpack5 ? webpack.EntryPlugin : webpack.SingleEntryPlugin)(\n    this.context,\n    `!!${request}`,\n    pluginName\n  ).apply(childCompiler)\n  new webpack.optimize.LimitChunkCountPlugin({ maxChunks: 1 }).apply(\n    childCompiler\n  )\n\n  let source\n\n  childCompiler.hooks.thisCompilation.tap(\n    `${pluginName} loader`,\n    (compilation) => {\n      const hook = isWebpack5\n        ? webpack.NormalModule.getCompilationHooks(compilation).loader\n        : compilation.hooks.normalModuleLoader\n      hook.tap(`${pluginName} loader`, (loaderContext, module) => {\n        // eslint-disable-next-line no-param-reassign\n        loaderContext.emitFile = this.emitFile\n\n        if (module.request === request) {\n          // eslint-disable-next-line no-param-reassign\n          module.loaders = loaders.map((loader) => {\n            return {\n              loader: loader.path,\n              options: loader.options,\n              ident: loader.ident,\n            }\n          })\n        }\n      })\n\n      if (isWebpack5) {\n        compilation.hooks.processAssets.tap(\n          {\n            name: pluginName,\n            // @ts-ignore TODO: Remove ignore when webpack 5 is stable\n            stage: webpack.Compilation.PROCESS_ASSETS_STAGE_ADDITIONAL,\n          },\n          (assets) => {\n            source = assets[childFilename] && assets[childFilename].source()\n\n            // Remove all chunk assets\n            Object.keys(assets).forEach((file) => delete assets[file])\n          }\n        )\n      }\n    }\n  )\n\n  // webpack 5 case is covered in hooks.thisCompilation above\n  if (!isWebpack5) {\n    childCompiler.hooks.afterCompile.tap(pluginName, (compilation) => {\n      source =\n        compilation.assets[childFilename] &&\n        compilation.assets[childFilename].source()\n\n      // Remove all chunk assets\n      compilation.chunks.forEach((chunk) => {\n        chunk.files.forEach((file) => {\n          delete compilation.assets[file] // eslint-disable-line no-param-reassign\n        })\n      })\n    })\n  }\n\n  const callback = this.async()\n\n  childCompiler.runAsChild((err, entries, compilation) => {\n    const addDependencies = (dependencies) => {\n      if (!Array.isArray(dependencies) && dependencies != null) {\n        throw new Error(\n          `Exported value was not extracted as an array: ${JSON.stringify(\n            dependencies\n          )}`\n        )\n      }\n\n      const identifierCountMap = new Map()\n\n      for (const dependency of dependencies) {\n        const count = identifierCountMap.get(dependency.identifier) || 0\n\n        this._module.addDependency(\n          new CssDependency(dependency, dependency.context, count)\n        )\n        identifierCountMap.set(dependency.identifier, count + 1)\n      }\n    }\n\n    if (err) {\n      return callback(err)\n    }\n\n    if (compilation.errors.length > 0) {\n      return callback(compilation.errors[0])\n    }\n\n    compilation.fileDependencies.forEach((dep) => {\n      this.addDependency(dep)\n    }, this)\n\n    compilation.contextDependencies.forEach((dep) => {\n      this.addContextDependency(dep)\n    }, this)\n\n    if (!source) {\n      return callback(new Error(\"Didn't get a result from child compiler\"))\n    }\n\n    let locals\n\n    try {\n      let dependencies\n      let exports = evalModuleCode(this, source, request)\n      // eslint-disable-next-line no-underscore-dangle\n      exports = exports.__esModule ? exports.default : exports\n      locals = exports && exports.locals\n      if (!Array.isArray(exports)) {\n        dependencies = [[null, exports]]\n      } else {\n        dependencies = exports.map(([id, content, media, sourceMap]) => {\n          const module = findModuleById(compilation, id)\n\n          return {\n            identifier: module.identifier(),\n            context: module.context,\n            content,\n            media,\n            sourceMap,\n          }\n        })\n      }\n      addDependencies(dependencies)\n    } catch (e) {\n      return callback(e)\n    }\n\n    const esModule =\n      typeof options.esModule !== 'undefined' ? options.esModule : false\n    const result = locals\n      ? `\\n${esModule ? 'export default' : 'module.exports ='} ${JSON.stringify(\n          locals\n        )};`\n      : esModule\n      ? `\\nexport {};`\n      : ''\n\n    let resultSource = `// extracted by ${pluginName}`\n\n    resultSource += result\n\n    return callback(null, resultSource)\n  })\n}\n\nexport default function () {}\n"]}